<?xml version="1.0" encoding="UTF-8"?>
<!-- Richly commented XML demo (see assistant response for details) -->
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:int="http://www.springframework.org/schema/integration"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
           https://www.springframework.org/schema/beans/spring-beans.xsd
           http://www.springframework.org/schema/integration
           https://www.springframework.org/schema/integration/spring-integration.xsd">

    <int:channel id="inputChannel"/>
    <int:channel id="transformChannel"/>
    <int:channel id="routerChannel"/>
    <int:channel id="splitChannel"/>
    <int:publish-subscribe-channel id="pubSubChannel"/>

    <int:transformer id="uppercaseTransformer"
                     input-channel="inputChannel"
                     output-channel="routerChannel"
                     expression="payload != null ? payload.toUpperCase() : payload"/>

    <int:router id="contentRouter"
                input-channel="routerChannel"
                expression="payload.startsWith('{') ? 'jsonChannel' 
                            : (payload.startsWith('&lt;') ? 'xmlChannel' : 'csvChannel')"/>
    <int:channel id="jsonChannel"/>
    <int:channel id="xmlChannel"/>
    <int:channel id="csvChannel"/>

    <int:service-activator input-channel="jsonChannel" ref="jsonHandler" method="handle"/>
    <bean id="jsonHandler" class="com.ads.apiseng.handlers.SimpleHandler">
        <constructor-arg value="JSON-HANDLER"/>
    </bean>

    <int:service-activator input-channel="xmlChannel" ref="xmlHandler" method="handle"/>
    <bean id="xmlHandler" class="com.ads.apiseng.handlers.SimpleHandler">
        <constructor-arg value="XML-HANDLER"/>
    </bean>

    <int:splitter input-channel="csvChannel"
                  output-channel="splitChannel"
                  expression="payload.split(',')"/>
    <int:bridge input-channel="splitChannel" output-channel="pubSubChannel"/>

    <int:service-activator input-channel="pubSubChannel" ref="csvHandler1" method="handle"/>
    <int:service-activator input-channel="pubSubChannel" ref="csvHandler2" method="handle"/>

    <bean id="csvHandler1" class="com.ads.apiseng.handlers.SimpleHandler">
        <constructor-arg value="CSV-HANDLER-1"/>
    </bean>
    <bean id="csvHandler2" class="com.ads.apiseng.handlers.SimpleHandler">
        <constructor-arg value="CSV-HANDLER-2"/>
    </bean>

</beans>
